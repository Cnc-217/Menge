<?xml version="1.0"?>

<BFSM>
   <GoalSet id="0">
      <Goal capacity="1000000" id="0" max_x="-8040.98" max_y="-599.11" min_x="-8914.84" min_y="-2003.52" type="AABB" weight="1.00"/>
      <Goal capacity="1000000" id="1" max_x="-3732.23" max_y="-4243.28" min_x="-5058.62" min_y="-4929.88" type="AABB" weight="1.00"/>
      <Goal capacity="1000000" id="2" max_x="-3568.93" max_y="3397.65" min_x="-4957.74" min_y="2742.26" type="AABB" weight="1.00"/>
      <Goal capacity="1000000" id="3" max_x="4333.43" max_y="3516.77" min_x="2897.81" min_y="2830.17" type="AABB" weight="1.00"/>
      <Goal capacity="1000000" id="4" max_x="-1076.01" max_y="-4504.77" min_x="-2449.22" min_y="-5253.79" type="AABB" weight="1.00"/>
      <Goal capacity="1000000" id="5" max_x="3985.87" max_y="-4707.79" min_x="2556.91" min_y="-5372.17" type="AABB" weight="1.00"/>
    </GoalSet>

<!-- 引导着-->
  <GoalSet id="1">
      <Goal capacity="1000000" type="agent" id="0" shape="circle" x="0" y="0" radius="30" idleader="0"/>
      <Goal capacity="1000000" type="agent" id="1" shape="circle" x="0" y="0" radius="30" idleader="1"/>
      <Goal capacity="1000000" type="agent" id="2" shape="circle" x="0" y="0" radius="30" idleader="2"/>
      <Goal capacity="1000000" type="agent" id="3" shape="circle" x="0" y="0" radius="30" idleader="3"/>
      <Goal capacity="1000000" type="agent" id="4" shape="circle" x="0" y="0" radius="30" idleader="4"/>
      <Goal capacity="1000000" type="agent" id="5" shape="circle" x="0" y="0" radius="30" idleader="5"/>
      <Goal capacity="1000000" type="agent" id="6" shape="circle" x="0" y="0" radius="30" idleader="6"/>
      <Goal capacity="1000000" type="agent" id="7" shape="circle" x="0" y="0" radius="30" idleader="7"/>
      <Goal capacity="1000000" type="agent" id="8" shape="circle" x="0" y="0" radius="30" idleader="8"/>
      <Goal capacity="1000000" type="agent" id="9" shape="circle" x="0" y="0" radius="30" idleader="9"/>
      <Goal capacity="1000000" type="agent" id="10" shape="circle" x="0" y="0" radius="30" idleader="10"/>
      <Goal capacity="1000000" type="agent" id="11" shape="circle" x="0" y="0" radius="30" idleader="11"/>
      <Goal capacity="1000000" type="agent" id="12" shape="circle" x="0" y="0" radius="30" idleader="12"/>
      <Goal capacity="1000000" type="agent" id="13" shape="circle" x="0" y="0" radius="30" idleader="13"/>
      <Goal capacity="1000000" type="agent" id="14" shape="circle" x="0" y="0" radius="30" idleader="14"/>
      <Goal capacity="1000000" type="agent" id="15" shape="circle" x="0" y="0" radius="30" idleader="15"/>
      <Goal capacity="1000000" type="agent" id="16" shape="circle" x="0" y="0" radius="30" idleader="16"/>
      <Goal capacity="1000000" type="agent" id="17" shape="circle" x="0" y="0" radius="30" idleader="17"/>
  </GoalSet>

<!-- 恐慌者 -->
  <GoalSet id="2">
      <Goal capacity="1000000" type="agent" id="18" shape="circle" x="0" y="0" radius="30" idleader="18"/>
      <Goal capacity="1000000" type="agent" id="19" shape="circle" x="0" y="0" radius="30" idleader="19"/>
      <Goal capacity="1000000" type="agent" id="20" shape="circle" x="0" y="0" radius="30" idleader="20"/>
      <Goal capacity="1000000" type="agent" id="21" shape="circle" x="0" y="0" radius="30" idleader="21"/>
      <Goal capacity="1000000" type="agent" id="22" shape="circle" x="0" y="0" radius="30" idleader="22"/>
      <Goal capacity="1000000" type="agent" id="23" shape="circle" x="0" y="0" radius="30" idleader="23"/>
      <Goal capacity="1000000" type="agent" id="24" shape="circle" x="0" y="0" radius="30" idleader="24"/>
      <Goal capacity="1000000" type="agent" id="25" shape="circle" x="0" y="0" radius="30" idleader="25"/>
      <Goal capacity="1000000" type="agent" id="26" shape="circle" x="0" y="0" radius="30" idleader="26"/>
      <Goal capacity="1000000" type="agent" id="27" shape="circle" x="0" y="0" radius="30" idleader="27"/>
      <Goal capacity="1000000" type="agent" id="28" shape="circle" x="0" y="0" radius="30" idleader="28"/>
      <Goal capacity="1000000" type="agent" id="29" shape="circle" x="0" y="0" radius="30" idleader="29"/>
      <Goal capacity="1000000" type="agent" id="30" shape="circle" x="0" y="0" radius="30" idleader="30"/>
      <Goal capacity="1000000" type="agent" id="31" shape="circle" x="0" y="0" radius="30" idleader="31"/>
      <Goal capacity="1000000" type="agent" id="32" shape="circle" x="0" y="0" radius="30" idleader="32"/>
  </GoalSet>


  <State name="Evacuation_lead" final="0" >
    <GoalSelector type="algorithm" goal_set="0" />
    <VelComponent type="road_map" file_name="graph.txt" />
    <Action type="distance_stress" exit_behavior="cool down"
      inner_dist="c" inner_value="100" 
      outer_dist="c" outer_value="120"
      fall_off="linear"
      shape_number="2" max_x1="-3762" min_x1="-4487" max_y1="2054" min_y1="1605"
      max_x2="3700" min_x2="3363" max_y2="2178" min_y2="1658"
      />
  </State>

<!-- <GoalSelector type="explicit" goal_set="1" goal="0"/> -->
 <State name="Follow_leader" final="0" >
    <GoalSelector type="near_agent" goal_set="1" />
    <VelComponent type="road_map" file_name="graph.txt" />
    <!-- <VelComponent type="goal" /> -->
    <Action type="distance_stress" exit_behavior="cool down"
      inner_dist="c" inner_value="100" 
      outer_dist="c" outer_value="120"
      fall_off="linear"
      shape_number="2" max_x1="-3762" min_x1="-4487" max_y1="2054" min_y1="1605"
      max_x2="3700" min_x2="3363" max_y2="2178" min_y2="1658"
      />
  </State>

 <State name="Follow_panic" final="0" >
    <GoalSelector type="near_agent" goal_set="2" />
    <VelComponent type="road_map" file_name="graph.txt" />
    <!-- <VelComponent type="goal" /> -->
    <Action type="distance_stress" exit_behavior="cool down"
      inner_dist="c" inner_value="100" 
      outer_dist="c" outer_value="120"
      fall_off="linear"
      shape_number="2" max_x1="-3762" min_x1="-4487" max_y1="2054" min_y1="1605"
      max_x2="3700" min_x2="3363" max_y2="2178" min_y2="1658"
      />
  </State>

 <State name="Evacuation_random" final="0" >
    <GoalSelector type="random" goal_set="0" />
    <VelComponent type="road_map" file_name="graph.txt" />
    <Action type="distance_stress" exit_behavior="cool down"
      inner_dist="c" inner_value="100" 
      outer_dist="c" outer_value="120"
      fall_off="linear"
      shape_number="2" max_x1="-3762" min_x1="-4487" max_y1="2054" min_y1="1605"
      max_x2="3700" min_x2="3363" max_y2="2178" min_y2="1658"
      />
  </State>



  <State name="Stop" final="1" >
    <GoalSelector type="identity" />
    <VelComponent type="zero" />
  </State>

  <Transition from="Evacuation_lead" to="Stop" >
    <Condition type="goal_reached" distance="1" />
  </Transition>

  <Transition from="Follow_leader" to="Stop" >
      <Condition type="leadergoal_reached" distance="30" />
  </Transition>

  <Transition from="Follow_panic" to="Stop" >
      <Condition type="leadergoal_reached" distance="30" />
  </Transition>

   <Transition from="Evacuation_random" to="Stop" >
      <Condition type="goal_reached" distance="1" />
  </Transition>

<!-- 这里只有trigger有用，其他的都是donothing -->
<EventSystem conservative="1">
    <Target name="target" type="agent_all"/>
    <Effect name="effect" type="set_agent_state_by_code"></Effect>
    <Event name="chage_goal">
      <Trigger name="neighborhood_search" type="neighborhood_search" timeSimulate="30"/>
      <Response effect="effect" target="target" />
    </Event>
</EventSystem>

</BFSM>