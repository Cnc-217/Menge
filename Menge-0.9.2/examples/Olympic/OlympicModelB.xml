<?xml version="1.0"?>

<BFSM>
   <!--  主仿真的目标点集合-->
   <GoalSet id="0">
        <!-- 滑雪场0 -->
        <Goal capacity="1000000" id="0" radius="214.56" type="circle" weight="1.00" x="-1063.35" y="1335.10"/>
        <Goal capacity="1000000" id="1" radius="200.13" type="circle" weight="1.00" x="-3158.18" y="-2427.94"/>
        <Goal capacity="1000000" id="2" radius="169.66" type="circle" weight="1.00" x="-891.28" y="-1889.59"/>

        <!-- 饭店1 -->
        <Goal capacity="1000000" id="3" radius="51.83" type="circle" weight="1.00" x="918.10" y="-1073.62"/>
        <Goal capacity="1000000" id="4" radius="54.43" type="circle" weight="1.00" x="1923.06" y="-1150.74"/>
        <Goal capacity="1000000" id="5" radius="51.54" type="circle" weight="1.00" x="2681.09" y="-1019.34"/>
        <Goal capacity="1000000" id="6" radius="44.15" type="circle" weight="1.00" x="1367.67" y="-2175.81"/>
        <Goal capacity="1000000" id="7" radius="55.65" type="circle" weight="1.00" x="1811.88" y="-2147.10"/>
        <Goal capacity="1000000" id="8" radius="42.88" type="circle" weight="1.00" x="2559.81" y="-2181.67"/>
        <Goal capacity="1000000" id="9" radius="54.43" type="circle" weight="1.00" x="1273.79" y="-1886.15"/>
        
        <!-- 颁奖广场2-->
        <Goal capacity="1000000" id="10" radius="255.09" type="circle" weight="1.00" x="134.09" y="-1787.49"/>

        <!-- 冬奥纪念品3-->
        <Goal capacity="1000000" id="11" radius="42.88" type="circle" weight="1.00" x="-300.52" y="-119.81"/>
        <Goal capacity="1000000" id="12" radius="54.43" type="circle" weight="1.00" x="558.59" y="132.87"/>

        <!-- 雪具商店4-->
        <Goal capacity="1000000" id="13" radius="50.54" type="circle" weight="1.00" x="-249.98" y="1638.84"/>
        <Goal capacity="1000000" id="14" radius="67.18" type="circle" weight="1.00" x="205.75" y="1803.82"/>

        <!-- 主题商店 复仇者联盟5-->
        <Goal capacity="1000000" id="15" radius="63.92" type="circle" weight="1.00" x="3459.35" y="1345.73"/>
        <Goal capacity="1000000" id="16" radius="64.72" type="circle" weight="1.00" x="3358.27" y="820.16"/>
        <Goal capacity="1000000" id="17" radius="64.72" type="circle" weight="1.00" x="3317.85" y="405.77"/>
        <Goal capacity="1000000" id="18" radius="58.93" type="circle" weight="1.00" x="3792.88" y="991.98"/>
        <Goal capacity="1000000" id="19" radius="58.93" type="circle" weight="1.00" x="2569.92" y="72.23"/>

        <!-- 服装店6-->
        <Goal capacity="1000000" id="20" radius="58.93" type="circle" weight="1.00" x="2064.56" y="2305.91"/>
        <Goal capacity="1000000" id="21" radius="50.54" type="circle" weight="1.00" x="1276.20" y="1972.38"/>
        <Goal capacity="1000000" id="22" radius="51.54" type="circle" weight="1.00" x="1589.52" y="1507.45"/>
        <Goal capacity="1000000" id="23" radius="63.92" type="circle" weight="1.00" x="2145.41" y="1588.31"/>
        <Goal capacity="1000000" id="24" radius="64.72" type="circle" weight="1.00" x="2772.06" y="1739.91"/>

        <!-- 主题商店 冰雪奇缘7-->
        <Goal capacity="1000000" id="25" radius="56.59" type="circle" weight="1.00" x="1122.87" y="687.53"/>
        <Goal capacity="1000000" id="26" radius="63.92" type="circle" weight="1.00" x="1599.63" y="142.98"/>
        <Goal capacity="1000000" id="27" radius="72.88" type="circle" weight="1.00" x="2044.34" y="921.23"/>

        <!-- noisePoint8 -->
        <Goal capacity="1000000" id="28" radius="50.54" type="circle" weight="1.00" x="2003.91" y="-483.66"/>
        <Goal capacity="1000000" id="29" radius="54.43" type="circle" weight="1.00" x="-1088.88" y="-958.70"/>
        <Goal capacity="1000000" id="30" radius="54.43" type="circle" weight="1.00" x="-482.45" y="-776.77"/>
        <Goal capacity="1000000" id="31" radius="78.94" type="circle" weight="1.00" x="-826.09" y="1972.38"/>
        <Goal capacity="1000000" id="32" radius="81.49" type="circle" weight="1.00" x="669.77" y="1315.41"/>
        <Goal capacity="1000000" id="33" radius="63.92" type="circle" weight="1.00" x="669.77" y="-281.52"/>
        
        <!-- 出口入口9 -->	
        <Goal capacity="1000000" id="34" radius="205.44" type="circle" weight="1.00" x="-3347.80" y="-601.36"/>
        <Goal capacity="1000000" id="35" radius="258.12" type="circle" weight="1.00" x="4467.77" y="-535.25"/>
    </GoalSet>

 <!-- 疏散的目标点集合 -->
    <GoalSet id="1"> 
        <Goal capacity="1000000" id="0" radius="205.44" type="circle" weight="1.00" x="-3347.80" y="-601.36"/>
        <Goal capacity="1000000" id="1" radius="258.12" type="circle" weight="1.00" x="4467.77" y="-535.25"/>
    </GoalSet>

 <!-- agent的目标点集合，将所有的agent放进来 -->
    <GoalSet id="2"> 
      <Goal capacity="1000000" type="agent" id="0" shape="circle" x="0" y="0" radius="30" idleader="0"/>
      <Goal capacity="1000000" type="agent" id="1" shape="circle" x="0" y="0" radius="30" idleader="1"/>
      <Goal capacity="1000000" type="agent" id="2" shape="circle" x="0" y="0" radius="30" idleader="2"/>
      <Goal capacity="1000000" type="agent" id="3" shape="circle" x="0" y="0" radius="30" idleader="3"/>
      <Goal capacity="1000000" type="agent" id="4" shape="circle" x="0" y="0" radius="30" idleader="4"/>
      <Goal capacity="1000000" type="agent" id="5" shape="circle" x="0" y="0" radius="30" idleader="5"/>
      <Goal capacity="1000000" type="agent" id="6" shape="circle" x="0" y="0" radius="30" idleader="6"/>
      <Goal capacity="1000000" type="agent" id="7" shape="circle" x="0" y="0" radius="30" idleader="7"/>
      <Goal capacity="1000000" type="agent" id="8" shape="circle" x="0" y="0" radius="30" idleader="8"/>
      <Goal capacity="1000000" type="agent" id="9" shape="circle" x="0" y="0" radius="30" idleader="9"/>
      <Goal capacity="1000000" type="agent" id="10" shape="circle" x="0" y="0" radius="30" idleader="10"/>
      <Goal capacity="1000000" type="agent" id="11" shape="circle" x="0" y="0" radius="30" idleader="11"/>
      <Goal capacity="1000000" type="agent" id="12" shape="circle" x="0" y="0" radius="30" idleader="12"/>
      <Goal capacity="1000000" type="agent" id="13" shape="circle" x="0" y="0" radius="30" idleader="13"/>
      <Goal capacity="1000000" type="agent" id="14" shape="circle" x="0" y="0" radius="30" idleader="14"/>
      <Goal capacity="1000000" type="agent" id="15" shape="circle" x="0" y="0" radius="30" idleader="15"/>
      <Goal capacity="1000000" type="agent" id="16" shape="circle" x="0" y="0" radius="30" idleader="16"/>
      <Goal capacity="1000000" type="agent" id="17" shape="circle" x="0" y="0" radius="30" idleader="17"/>
      <Goal capacity="1000000" type="agent" id="18" shape="circle" x="0" y="0" radius="30" idleader="18"/>
      <Goal capacity="1000000" type="agent" id="19" shape="circle" x="0" y="0" radius="30" idleader="19"/>
      <Goal capacity="1000000" type="agent" id="20" shape="circle" x="0" y="0" radius="30" idleader="20"/>
      <Goal capacity="1000000" type="agent" id="21" shape="circle" x="0" y="0" radius="30" idleader="21"/>
      <Goal capacity="1000000" type="agent" id="22" shape="circle" x="0" y="0" radius="30" idleader="22"/>
      <Goal capacity="1000000" type="agent" id="23" shape="circle" x="0" y="0" radius="30" idleader="23"/>
      <Goal capacity="1000000" type="agent" id="24" shape="circle" x="0" y="0" radius="30" idleader="24"/>
      <Goal capacity="1000000" type="agent" id="25" shape="circle" x="0" y="0" radius="30" idleader="25"/>
      <Goal capacity="1000000" type="agent" id="26" shape="circle" x="0" y="0" radius="30" idleader="26"/>
      <Goal capacity="1000000" type="agent" id="27" shape="circle" x="0" y="0" radius="30" idleader="27"/>
      <Goal capacity="1000000" type="agent" id="28" shape="circle" x="0" y="0" radius="30" idleader="28"/>
      <Goal capacity="1000000" type="agent" id="29" shape="circle" x="0" y="0" radius="30" idleader="29"/>
      <Goal capacity="1000000" type="agent" id="30" shape="circle" x="0" y="0" radius="30" idleader="30"/>
      <Goal capacity="1000000" type="agent" id="31" shape="circle" x="0" y="0" radius="30" idleader="31"/>
      <Goal capacity="1000000" type="agent" id="32" shape="circle" x="0" y="0" radius="30" idleader="32"/>
      <Goal capacity="1000000" type="agent" id="33" shape="circle" x="0" y="0" radius="30" idleader="33"/>
      <Goal capacity="1000000" type="agent" id="34" shape="circle" x="0" y="0" radius="30" idleader="34"/>
      <Goal capacity="1000000" type="agent" id="35" shape="circle" x="0" y="0" radius="30" idleader="35"/>
      <Goal capacity="1000000" type="agent" id="36" shape="circle" x="0" y="0" radius="30" idleader="36"/>
      <Goal capacity="1000000" type="agent" id="37" shape="circle" x="0" y="0" radius="30" idleader="37"/>
      <Goal capacity="1000000" type="agent" id="38" shape="circle" x="0" y="0" radius="30" idleader="38"/>
      <Goal capacity="1000000" type="agent" id="39" shape="circle" x="0" y="0" radius="30" idleader="39"/>
      <Goal capacity="1000000" type="agent" id="40" shape="circle" x="0" y="0" radius="30" idleader="40"/>
      <Goal capacity="1000000" type="agent" id="41" shape="circle" x="0" y="0" radius="30" idleader="41"/>
      <Goal capacity="1000000" type="agent" id="42" shape="circle" x="0" y="0" radius="30" idleader="42"/>
      <Goal capacity="1000000" type="agent" id="43" shape="circle" x="0" y="0" radius="30" idleader="43"/>
      <Goal capacity="1000000" type="agent" id="44" shape="circle" x="0" y="0" radius="30" idleader="44"/>
      <Goal capacity="1000000" type="agent" id="45" shape="circle" x="0" y="0" radius="30" idleader="45"/>
      <Goal capacity="1000000" type="agent" id="46" shape="circle" x="0" y="0" radius="30" idleader="46"/>
      <Goal capacity="1000000" type="agent" id="47" shape="circle" x="0" y="0" radius="30" idleader="47"/>
      <Goal capacity="1000000" type="agent" id="48" shape="circle" x="0" y="0" radius="30" idleader="48"/>
      <Goal capacity="1000000" type="agent" id="49" shape="circle" x="0" y="0" radius="30" idleader="49"/>
      <Goal capacity="1000000" type="agent" id="50" shape="circle" x="0" y="0" radius="30" idleader="50"/>
      <Goal capacity="1000000" type="agent" id="51" shape="circle" x="0" y="0" radius="30" idleader="51"/>
      <Goal capacity="1000000" type="agent" id="52" shape="circle" x="0" y="0" radius="30" idleader="52"/>
      <Goal capacity="1000000" type="agent" id="53" shape="circle" x="0" y="0" radius="30" idleader="53"/>
      <Goal capacity="1000000" type="agent" id="54" shape="circle" x="0" y="0" radius="30" idleader="54"/>
      <Goal capacity="1000000" type="agent" id="55" shape="circle" x="0" y="0" radius="30" idleader="55"/>
      <Goal capacity="1000000" type="agent" id="56" shape="circle" x="0" y="0" radius="30" idleader="56"/>
      <Goal capacity="1000000" type="agent" id="57" shape="circle" x="0" y="0" radius="30" idleader="57"/>
      <Goal capacity="1000000" type="agent" id="58" shape="circle" x="0" y="0" radius="30" idleader="58"/>
      <Goal capacity="1000000" type="agent" id="59" shape="circle" x="0" y="0" radius="30" idleader="59"/>
      <Goal capacity="1000000" type="agent" id="60" shape="circle" x="0" y="0" radius="30" idleader="60"/>
      <Goal capacity="1000000" type="agent" id="61" shape="circle" x="0" y="0" radius="30" idleader="61"/>
      <Goal capacity="1000000" type="agent" id="62" shape="circle" x="0" y="0" radius="30" idleader="62"/>
      <Goal capacity="1000000" type="agent" id="63" shape="circle" x="0" y="0" radius="30" idleader="63"/>
      <Goal capacity="1000000" type="agent" id="64" shape="circle" x="0" y="0" radius="30" idleader="64"/>
      <Goal capacity="1000000" type="agent" id="65" shape="circle" x="0" y="0" radius="30" idleader="65"/>
      <Goal capacity="1000000" type="agent" id="66" shape="circle" x="0" y="0" radius="30" idleader="66"/>
      <Goal capacity="1000000" type="agent" id="67" shape="circle" x="0" y="0" radius="30" idleader="67"/>
      <Goal capacity="1000000" type="agent" id="68" shape="circle" x="0" y="0" radius="30" idleader="68"/>
      <Goal capacity="1000000" type="agent" id="69" shape="circle" x="0" y="0" radius="30" idleader="69"/>
      <Goal capacity="1000000" type="agent" id="70" shape="circle" x="0" y="0" radius="30" idleader="70"/>
      <Goal capacity="1000000" type="agent" id="71" shape="circle" x="0" y="0" radius="30" idleader="71"/>
      <Goal capacity="1000000" type="agent" id="72" shape="circle" x="0" y="0" radius="30" idleader="72"/>
      <Goal capacity="1000000" type="agent" id="73" shape="circle" x="0" y="0" radius="30" idleader="73"/>
      <Goal capacity="1000000" type="agent" id="74" shape="circle" x="0" y="0" radius="30" idleader="74"/>
      <Goal capacity="1000000" type="agent" id="75" shape="circle" x="0" y="0" radius="30" idleader="75"/>
      <Goal capacity="1000000" type="agent" id="76" shape="circle" x="0" y="0" radius="30" idleader="76"/>
      <Goal capacity="1000000" type="agent" id="77" shape="circle" x="0" y="0" radius="30" idleader="77"/>
      <Goal capacity="1000000" type="agent" id="78" shape="circle" x="0" y="0" radius="30" idleader="78"/>
      <Goal capacity="1000000" type="agent" id="79" shape="circle" x="0" y="0" radius="30" idleader="79"/>
      <Goal capacity="1000000" type="agent" id="80" shape="circle" x="0" y="0" radius="30" idleader="70"/>
      <Goal capacity="1000000" type="agent" id="81" shape="circle" x="0" y="0" radius="30" idleader="81"/>
      <Goal capacity="1000000" type="agent" id="82" shape="circle" x="0" y="0" radius="30" idleader="82"/>
      <Goal capacity="1000000" type="agent" id="83" shape="circle" x="0" y="0" radius="30" idleader="83"/>
      <Goal capacity="1000000" type="agent" id="84" shape="circle" x="0" y="0" radius="30" idleader="84"/>
      <Goal capacity="1000000" type="agent" id="85" shape="circle" x="0" y="0" radius="30" idleader="85"/>
      <Goal capacity="1000000" type="agent" id="86" shape="circle" x="0" y="0" radius="30" idleader="86"/>
      <Goal capacity="1000000" type="agent" id="87" shape="circle" x="0" y="0" radius="30" idleader="87"/>
      <Goal capacity="1000000" type="agent" id="88" shape="circle" x="0" y="0" radius="30" idleader="88"/>
      <Goal capacity="1000000" type="agent" id="89" shape="circle" x="0" y="0" radius="30" idleader="89"/>
      <Goal capacity="1000000" type="agent" id="90" shape="circle" x="0" y="0" radius="30" idleader="90"/>
      <Goal capacity="1000000" type="agent" id="91" shape="circle" x="0" y="0" radius="30" idleader="91"/>
      <Goal capacity="1000000" type="agent" id="92" shape="circle" x="0" y="0" radius="30" idleader="92"/>
      <Goal capacity="1000000" type="agent" id="93" shape="circle" x="0" y="0" radius="30" idleader="93"/>
      <Goal capacity="1000000" type="agent" id="94" shape="circle" x="0" y="0" radius="30" idleader="94"/>
      <Goal capacity="1000000" type="agent" id="95" shape="circle" x="0" y="0" radius="30" idleader="95"/>
      <Goal capacity="1000000" type="agent" id="96" shape="circle" x="0" y="0" radius="30" idleader="96"/>
      <Goal capacity="1000000" type="agent" id="97" shape="circle" x="0" y="0" radius="30" idleader="97"/>
      <Goal capacity="1000000" type="agent" id="98" shape="circle" x="0" y="0" radius="30" idleader="98"/>
      <Goal capacity="1000000" type="agent" id="99" shape="circle" x="0" y="0" radius="30" idleader="99"/>
      <Goal capacity="1000000" type="agent" id="100" shape="circle" x="0" y="0" radius="30" idleader="100"/>
      <Goal capacity="1000000" type="agent" id="101" shape="circle" x="0" y="0" radius="30" idleader="101"/>
      <Goal capacity="1000000" type="agent" id="102" shape="circle" x="0" y="0" radius="30" idleader="102"/>
      <Goal capacity="1000000" type="agent" id="103" shape="circle" x="0" y="0" radius="30" idleader="103"/>
      <Goal capacity="1000000" type="agent" id="104" shape="circle" x="0" y="0" radius="30" idleader="104"/>
      <Goal capacity="1000000" type="agent" id="105" shape="circle" x="0" y="0" radius="30" idleader="105"/>
      <Goal capacity="1000000" type="agent" id="106" shape="circle" x="0" y="0" radius="30" idleader="106"/>
      <Goal capacity="1000000" type="agent" id="107" shape="circle" x="0" y="0" radius="30" idleader="107"/>
      <Goal capacity="1000000" type="agent" id="108" shape="circle" x="0" y="0" radius="30" idleader="108"/>
      <Goal capacity="1000000" type="agent" id="109" shape="circle" x="0" y="0" radius="30" idleader="109"/>
      <Goal capacity="1000000" type="agent" id="110" shape="circle" x="0" y="0" radius="30" idleader="110"/>
      <Goal capacity="1000000" type="agent" id="111" shape="circle" x="0" y="0" radius="30" idleader="111"/>
      <Goal capacity="1000000" type="agent" id="112" shape="circle" x="0" y="0" radius="30" idleader="112"/>
      <Goal capacity="1000000" type="agent" id="113" shape="circle" x="0" y="0" radius="30" idleader="113"/>
    </GoalSet>


  <State name="wait" final="0" >
    <GoalSelector type="identity" />
    <VelComponent type="zero" />
  </State>

  <State name="tour" final="0" >
    <GoalSelector type="Model" goal_set="0"/>
    <!-- <GoalSelector type="random" goal_set="0"/> -->
    <VelComponent type="road_map" file_name="graph.txt" />
   <Action type="stress" exit_behavior="cool down"
      inner_dist="c" inner_value="100" 
      outer_dist="c" outer_value="120"
      fall_off="linear"
      shape_number="2" 
      max_x0="-2300" min_x0="-3000" max_y0="-580" min_y0="-1000"
      max_x1="4180" min_x1="3200" max_y1="-100" min_y1="-600"
      />
  </State>


  <State name="Stop" final="0" >
    <GoalSelector type="nearest" goal_set="1" />
    <VelComponent type="goal" />
  </State>

 <State name="EndSimulate" final="1" >
    <GoalSelector type="identity" />
    <VelComponent type="zero" />
  </State>

 <State name="Evacuation" final="0" >
    <GoalSelector type="evacuation" goal_set="1" algorithmID="3" />
    <VelComponent type="road_map" file_name="graph.txt" />
     <Action type="stress" exit_behavior="cool down"
      inner_dist="c" inner_value="100" 
      outer_dist="c" outer_value="120"
      fall_off="linear"
      shape_number="2" 
      max_x0="-2300" min_x0="-3000" max_y0="-580" min_y0="-1000"
      max_x1="4180" min_x1="3200" max_y1="-100" min_y1="-600"
      />
  </State>

  <State name="Agent" final="0" >
    <GoalSelector type="evacuation" goal_set="2" algorithmID="0" />
    <VelComponent type="road_map" file_name="graph.txt" />
  </State>

  <Transition from="tour" to="tour" >
    <!-- <Condition type="goal_reached" distance="5" />-->
    <Condition type="goal_reached_wait" distance="5"/>     
    <!-- 这里需要修改源码实现不同的店停留不同的时间-->
  </Transition>

  <Transition from="Stop" to="EndSimulate" >
    <Condition type="goal_reached" distance="5" />
  </Transition>

<!-- 这里只有trigger有用，其他的都是donothing -->
  <EventSystem conservative="1">
    <Target name="target" type="agent_all"/>
    <Effect name="effect" type="set_agent_state_by_code"></Effect>
    <Event name="Olympic">
      <Trigger name="Evacuation" type="neighborhood_search" timeSimulate="30"/>
      <Response effect="effect" target="target" />
    </Event>
  </EventSystem> 


</BFSM>

